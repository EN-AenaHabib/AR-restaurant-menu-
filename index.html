<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Bella Vista | AR Scanner</title>
  
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    :root {
      --accent: #00f2ff; /* Cyber Blue */
      --warning: #ff6b00; /* Pizza Orange */
    }

    body { margin: 0; overflow: hidden; font-family: 'Courier New', Courier, monospace; background: #000; }

    /* --- Loading Screen --- */
    #loader {
      position: fixed; inset: 0; z-index: 10000;
      background: #000; display: flex; flex-direction: column;
      align-items: center; justify-content: center; color: var(--accent);
    }
    .glitch { font-size: 24px; font-weight: bold; text-transform: uppercase; letter-spacing: 5px; animation: pulse 2s infinite; }

    /* --- Scanner UI Overlay --- */
    #overlay {
      position: fixed; inset: 0; z-index: 10;
      pointer-events: none; border: 1px solid rgba(0, 242, 255, 0.1);
      display: none;
    }

    /* The Center Reticle (Scanning Bracket) */
    .reticle {
      position: absolute; top: 50%; left: 50%;
      width: 250px; height: 250px;
      transform: translate(-50%, -50%);
      border: 2px solid rgba(0, 242, 255, 0.3);
    }
    .reticle::before, .reticle::after {
      content: ''; position: absolute; width: 20px; height: 20px;
      border: 3px solid var(--accent);
    }
    /* Corners */
    .reticle-tl { top: -5px; left: -5px; border-right: 0; border-bottom: 0; }
    .reticle-tr { top: -5px; right: -5px; border-left: 0; border-bottom: 0; }
    .reticle-bl { bottom: -5px; left: -5px; border-right: 0; border-top: 0; }
    .reticle-br { bottom: -5px; right: -5px; border-left: 0; border-top: 0; }

    /* Moving Scan Line */
    .line {
      position: absolute; width: 100%; height: 2px;
      background: var(--accent); box-shadow: 0 0 15px var(--accent);
      top: 0; animation: move 3s linear infinite;
    }

    @keyframes move { 0% { top: 0%; } 100% { top: 100%; } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

    /* Bottom Status Bar */
    .status-bar {
      position: fixed; bottom: 0; width: 100%; height: 60px;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(10px);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px; box-sizing: border-box; color: var(--accent);
      border-top: 1px solid var(--accent); z-index: 20;
    }

    .btn-rotate {
      background: var(--accent); color: #000; border: none;
      padding: 10px 20px; font-weight: bold; border-radius: 4px;
      text-transform: uppercase; font-size: 12px; pointer-events: auto;
    }

    /* Detected State */
    .detected { color: var(--warning) !important; border-color: var(--warning) !important; }
  </style>
</head>
<body>

  <div id="loader">
    <div class="glitch">Initializing AR...</div>
    <button onclick="initAR()" style="margin-top:20px; padding:10px 30px; background:var(--accent); border:none; cursor:pointer;">START CAMERA</button>
  </div>

  <div id="overlay">
    <div class="reticle">
      <div class="line"></div>
      <div class="reticle-tl"></div><div class="reticle-tr"></div>
      <div class="reticle-bl"></div><div class="reticle-br"></div>
    </div>
    
    <div class="status-bar">
      <div id="status-text">SYSTEM: SCANNING...</div>
      <button class="btn-rotate" onclick="rotatePizza()">Rotate</button>
    </div>
  </div>

  <a-scene 
    embedded 
    arjs="sourceType: webcam; debugUIEnabled: false; displayWidth: 1280; displayHeight: 720;"
    vr-mode-ui="enabled: false"
    renderer="antialias: true; alpha: true; precision: medium;">

    <a-assets>
      <a-asset-item id="pizza" src="pizza.glb"></a-asset-item>
    </a-assets>

    <a-marker type="pattern" url="pattern_images.patt" id="marker">
      <a-entity 
        id="pizza-model"
        gltf-model="#pizza" 
        scale="0.2 0.2 0.2" 
        position="0 0 0" 
        rotation="-90 0 0"
        visible="false">
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const model = document.querySelector('#pizza-model');
    const marker = document.querySelector('#marker');
    const statusText = document.querySelector('#status-text');
    const overlay = document.querySelector('#overlay');
    const reticleLines = document.querySelectorAll('.reticle div');

    function initAR() {
      document.querySelector('#loader').style.display = 'none';
      overlay.style.display = 'block';
    }

    marker.addEventListener('markerFound', () => {
      model.setAttribute('visible', 'true');
      statusText.innerText = "SYSTEM: TARGET ACQUIRED";
      statusText.style.color = "var(--warning)";
      document.querySelector('.line').style.display = "none";
      // Change reticle color to orange
      document.querySelectorAll('.reticle div').forEach(el => el.style.borderColor = "var(--warning)");
    });

    marker.addEventListener('markerLost', () => {
      model.setAttribute('visible', 'false');
      statusText.innerText = "SYSTEM: SCANNING...";
      statusText.style.color = "var(--accent)";
      document.querySelector('.line').style.display = "block";
      document.querySelectorAll('.reticle div').forEach(el => el.style.borderColor = "var(--accent)");
    });

    function rotatePizza() {
      const rot = model.getAttribute('rotation');
      model.setAttribute('rotation', {x: rot.x, y: rot.y + 45, z: rot.z});
    }
  </script>
</body>
</html>
