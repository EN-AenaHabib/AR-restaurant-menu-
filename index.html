<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <title>AR Menu</title>

  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    * { margin:0; padding:0; }
    html, body { width:100%; height:100%; overflow:hidden; background:#000; }

    .a-enter-ar, .a-enter-vr, .rs-base,
    #ARjsDebugUIContainer, .a-orientation-modal,
    .a-dialog, .a-loader-title { display:none !important; }

    /* ‚îÄ‚îÄ SPLASH ‚îÄ‚îÄ */
    #splash {
      position:fixed; inset:0; z-index:9999;
      background:#000;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center; gap:20px;
      font-family: Arial, sans-serif;
    }
    #splash h1   { color:#ff9b3c; font-size:24px; }
    #splash p    { color:#aaa; font-size:13px; text-align:center; max-width:260px; line-height:1.6; }
    .mframe      { width:140px; height:140px; background:#fff; border:3px solid #ff6b00; border-radius:10px; overflow:hidden; }
    .mframe img  { width:100%; height:100%; }
    #goBtn {
      padding:14px 50px; background:#ff6b00; border:none; border-radius:40px;
      color:#fff; font-size:16px; font-weight:700; cursor:pointer;
    }

    /* ‚îÄ‚îÄ AR scene fills screen ‚îÄ‚îÄ */
    #arWrap { display:none; position:fixed; inset:0; z-index:1; }
    #arWrap a-scene,
    #arWrap canvas {
      width:100% !important; height:100% !important;
      position:absolute !important; top:0 !important; left:0 !important;
    }

    /* ‚îÄ‚îÄ Controls (bottom strip) ‚îÄ‚îÄ */
    #ctrl {
      display:none; position:fixed; bottom:0; left:0; right:0; z-index:100;
      background:rgba(0,0,0,0.75);
      padding:12px 14px 22px;
      display:none; flex-direction:column; gap:10px;
      font-family:Arial, sans-serif;
    }
    .row { display:flex; align-items:center; gap:10px; }
    .lbl { color:#ff9b3c; font-size:11px; font-weight:700; min-width:34px; }
    #szSlider {
      flex:1; -webkit-appearance:none; height:4px; border-radius:4px; outline:none;
      background:linear-gradient(90deg,#ff6b00 50%,#333 50%);
    }
    #szSlider::-webkit-slider-thumb {
      -webkit-appearance:none; width:22px; height:22px; border-radius:50%;
      background:#ff9b3c; cursor:pointer;
    }
    .val { color:#fff; font-size:11px; min-width:30px; text-align:right; }
    .btns { display:flex; gap:8px; }
    .btn {
      flex:1; padding:11px 2px; border-radius:10px; border:1.5px solid rgba(255,107,0,0.35);
      background:rgba(255,255,255,0.06); color:rgba(255,200,130,0.8);
      font-size:11px; font-weight:700; text-align:center; cursor:pointer;
      user-select:none; -webkit-user-select:none;
    }
    .btn.on { background:rgba(255,85,0,0.4); border-color:#ff6b00; color:#fff; }
  </style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <h1>üçï AR Menu</h1>
  <div class="mframe">
    <img src="pattern_images.png" alt="Pizza Marker"/>
  </div>
  <p>Place the pizza icon on the table, then tap Start.</p>
  <button id="goBtn" onclick="go()">Start AR</button>
</div>

<!-- AR SCENE -->
<div id="arWrap">
  <a-scene
    id="sc"
    embedded
    arjs="sourceType:webcam; debugUIEnabled:false;"
    renderer="antialias:false; logarithmicDepthBuffer:true; precision:medium;"
    vr-mode-ui="enabled:false"
    loading-screen="enabled:false"
    device-orientation-permission-ui="enabled:false">

    <a-assets timeout="20000">
      <a-asset-item id="pm" src="pizza.glb"></a-asset-item>
    </a-assets>

    <!-- Marker for Pizza -->
    <a-marker type="pattern" url="pattern_images.patt" id="mk" smooth="true" smooth-count="5">
      <a-gltf-model
        id="pizza"
        src="#pm"
        position="0 0 0"
        rotation="-90 0 0"
        scale="0.2 0.2 0.2"
        visible="false">
      </a-gltf-model>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>
</div>

<!-- CONTROLS -->
<div id="ctrl">
  <div class="row">
    <span class="lbl">SIZE</span>
    <input type="range" id="szSlider" min="1" max="100" value="40" oninput="resize(this.value)"/>
    <span class="val" id="szVal">1.0√ó</span>
  </div>
  <div class="btns">
    <div class="btn on"  id="bView"   onclick="mode('view')">üëÅ VIEW</div>
    <div class="btn"     id="bMove"   onclick="mode('move')">‚úã MOVE</div>
    <div class="btn"     id="bRot"    onclick="mode('rotate')">üîÑ ROTATE</div>
    <div class="btn"     onclick="reset()">‚Ü∫ RESET</div>
  </div>
</div>

<script>
var m = 'view';          // current mode
var baseScale = 0.2;     // initial scale
var lx=0, ly=0;
var pd=0, ps=0.2;

function go() {
  document.getElementById('splash').style.display = 'none';
  document.getElementById('arWrap').style.display = 'block';

  var pizza = document.getElementById('pizza');
  var marker = document.getElementById('mk');

  function ready() {
    document.getElementById('ctrl').style.display = 'flex';

    // Detect marker visibility
    marker.addEventListener('markerFound', () => {
      pizza.setAttribute('visible', 'true');
    });
    marker.addEventListener('markerLost', () => {
      pizza.setAttribute('visible', 'false');
    });

    wireTouch();
  }

  var sc = document.getElementById('sc');
  if (sc.hasLoaded) ready();
  else sc.addEventListener('loaded', ready, { once:true });
  setTimeout(function(){ if(document.getElementById('ctrl').style.display==='none') ready(); }, 6000);
}

function wireTouch() {
  var cvs = document.querySelector('#arWrap canvas');
  if (!cvs) { setTimeout(wireTouch, 800); return; }

  cvs.addEventListener('touchstart', function(e) {
    if (e.touches.length===1) { lx=e.touches[0].clientX; ly=e.touches[0].clientY; }
    if (e.touches.length===2) { pd=pinch(e); ps=baseScale; }
  }, {passive:true});

  cvs.addEventListener('touchmove', function(e) {
    var pizza = document.getElementById('pizza');
    if (!pizza) return;

    if (e.touches.length===1) {
      var dx = e.touches[0].clientX - lx;
      var dy = e.touches[0].clientY - ly;
      if (m==='move') {
        var p = pizza.getAttribute('position');
        pizza.setAttribute('position', {x: p.x+dx*0.0015, y: p.y, z: p.z+dy*0.0015});
      }
      if (m==='rotate') {
        var r = pizza.getAttribute('rotation');
        pizza.setAttribute('rotation', {x: r.x, y: r.y+dx*0.6, z: r.z});
      }
      lx=e.touches[0].clientX; ly=e.touches[0].clientY;
    }

    if (e.touches.length===2) {
      var d = pinch(e);
      baseScale = Math.min(Math.max(ps*(d/pd), 0.02), 1.5);
      pizza.setAttribute('scale', baseScale+' '+baseScale+' '+baseScale);
      syncSlider(baseScale);
      e.preventDefault();
    }
  }, {passive:false});
}

function pinch(e) {
  var dx=e.touches[0].clientX-e.touches[1].clientX;
  var dy=e.touches[0].clientY-e.touches[1].clientY;
  return Math.sqrt(dx*dx+dy*dy);
}

function mode(v) {
  m = v;
  ['View','Move','Rot'].forEach(function(x){ document.getElementById('b'+x).classList.remove('on'); });
  var map = {view:'View', move:'Move', rotate:'Rot'};
  document.getElementById('b'+map[v]).classList.add('on');
}

function resize(v) {
  baseScale = 0.02 + (v/100)*0.58;
  var pizza = document.getElementById('pizza');
  if (pizza) pizza.setAttribute('scale', baseScale+' '+baseScale+' '+baseScale);
  document.getElementById('szVal').textContent = (baseScale/0.2).toFixed(1)+'√ó';
  document.getElementById('szSlider').style.background =
    'linear-gradient(90deg,#ff6b00 '+v+'%,#333 '+v+'%)';
}

function syncSlider(s) {
  var v = Math.round(((s-0.02)/0.58)*100);
  document.getElementById('szSlider').value = Math.min(100,Math.max(1,v));
  document.getElementById('szVal').textContent = (s/0.2).toFixed(1)+'√ó';
}

function reset() {
  var pizza = document.getElementById('pizza');
  if (!pizza) return;
  pizza.setAttribute('position','0 0 0');
  pizza.setAttribute('rotation','-90 0 0');
  baseScale = 0.2;
  pizza.setAttribute('scale','0.2 0.2 0.2');
  document.getElementById('szSlider').value = 40;
  document.getElementById('szVal').textContent = '1.0√ó';
}
</script>
</body>
</html>
