<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>AR Restaurant Menu</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <!-- AR.js for A-Frame (marker-based, no ARCore needed) -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; font-family: 'Segoe UI', Arial, sans-serif; overflow: hidden; touch-action: none; }

    /* ‚îÄ‚îÄ SPLASH SCREEN ‚îÄ‚îÄ */
    #splash {
      position: fixed; inset: 0; z-index: 9999;
      background: radial-gradient(ellipse at center, #2a0e00 0%, #0d0400 100%);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 16px;
      padding: 30px;
    }
    .splash-icon { font-size: 72px; animation: bob 2s ease-in-out infinite; }
    @keyframes bob { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }
    .splash-title {
      font-size: 30px; font-weight: 900; letter-spacing: 3px;
      color: #ff9b3c; text-transform: uppercase;
    }
    .splash-sub { color: #ffcc9966; font-size: 13px; text-align: center; max-width: 260px; line-height: 1.7; }

    /* Marker preview box */
    .marker-box {
      width: 160px; height: 160px; margin: 8px 0;
      border: 3px solid #ff6b00; border-radius: 16px; overflow: hidden;
      position: relative; display: flex; align-items: center; justify-content: center;
    }
    .marker-box img { width: 100%; height: 100%; object-fit: contain; }
    .marker-hint {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: rgba(255,107,0,0.85); color: white;
      font-size: 10px; font-weight: 700; text-align: center;
      padding: 4px; letter-spacing: 1px;
    }
    .scan-line-anim {
      position: absolute; width: 80%; height: 2px;
      background: linear-gradient(90deg, transparent, #ff6b00, transparent);
      animation: scanAnim 2s linear infinite;
    }
    @keyframes scanAnim { 0%{top:10%} 100%{top:88%} }
    .marker-label { color: #ffcc9988; font-size: 12px; text-align: center; }

    /* Start button */
    #launch-btn {
      margin-top: 8px; padding: 16px 52px;
      background: linear-gradient(135deg, #ff6b00, #ffaa44);
      border: none; border-radius: 50px; color: white;
      font-size: 17px; font-weight: 800; letter-spacing: 1px;
      cursor: pointer; text-transform: uppercase;
      box-shadow: 0 8px 30px rgba(255,107,0,0.45);
      transition: transform 0.15s;
    }
    #launch-btn:active { transform: scale(0.95); }
    .badge {
      font-size: 10px; background: rgba(255,107,0,0.2);
      border: 1px solid rgba(255,107,0,0.4);
      color: #ff9b3c; padding: 4px 12px;
      border-radius: 20px; letter-spacing: 1px;
    }

    /* ‚îÄ‚îÄ AR SCENE ‚îÄ‚îÄ */
    #ar-scene-wrap { position: fixed; inset: 0; z-index: 1; display: none; }

    /* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
    #hud { position: fixed; inset: 0; z-index: 100; pointer-events: none; display: none; }

    /* Top bar */
    #topbar {
      position: absolute; top: 0; left: 0; right: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
      padding: 14px 18px 28px;
      display: flex; align-items: center; justify-content: space-between;
      pointer-events: all;
    }
    .brand { color: #ff9b3c; font-size: 17px; font-weight: 800; letter-spacing: 1px; }
    .ar-badge {
      background: rgba(255,107,0,0.25); border: 1px solid #ff6b00;
      color: #ff9b3c; font-size: 10px; font-weight: 700;
      padding: 4px 10px; border-radius: 20px; letter-spacing: 1px;
      animation: glowBadge 2s ease-in-out infinite;
    }
    @keyframes glowBadge { 0%,100%{box-shadow:none} 50%{box-shadow:0 0 12px #ff6b0088} }

    /* Tracking status */
    #track-status {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center; pointer-events: none;
      transition: opacity 0.4s;
    }
    #track-status .finder {
      width: 170px; height: 170px; margin: 0 auto 12px;
      border: 2px dashed rgba(255,107,0,0.5); border-radius: 16px;
      display: flex; align-items: center; justify-content: center;
      font-size: 52px;
      animation: findPulse 1.6s ease-in-out infinite;
    }
    @keyframes findPulse {
      0%,100%{border-color:rgba(255,107,0,0.3);transform:scale(1)}
      50%{border-color:rgba(255,107,0,0.9);transform:scale(1.04)}
    }
    #track-status p { color: #ffcc9977; font-size: 13px; }
    #track-status.hidden { opacity: 0; }

    /* Right controls */
    #right-ctrl {
      position: absolute; right: 12px; top: 50%;
      transform: translateY(-50%);
      display: flex; flex-direction: column; gap: 8px;
      pointer-events: all;
    }
    .ctrl-group { display: flex; flex-direction: column; align-items: center; gap: 2px; }
    .cbtn {
      width: 50px; height: 50px; border-radius: 14px;
      background: rgba(0,0,0,0.72); border: 1.5px solid rgba(255,107,0,0.35);
      color: white; font-size: 21px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; backdrop-filter: blur(8px);
      transition: all 0.18s; user-select: none; -webkit-user-select: none;
    }
    .cbtn:active { transform: scale(0.9); background: rgba(255,107,0,0.4); }
    .cbtn.active { background: rgba(255,107,0,0.45); border-color: #ff6b00; }
    .clabel { color: #ff9b3c77; font-size: 9px; letter-spacing: 0.5px; }

    /* Bottom bar */
    #bottombar {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: linear-gradient(0deg, rgba(0,0,0,0.88) 0%, transparent 100%);
      padding: 18px 16px 26px;
      pointer-events: all;
      display: flex; flex-direction: column; gap: 12px;
    }

    /* Size slider */
    .slider-row { display: flex; align-items: center; gap: 10px; }
    .slider-label { color: #ff9b3c; font-size: 11px; font-weight: 700; min-width: 34px; }
    #sizeSlider {
      flex: 1; -webkit-appearance: none; height: 4px;
      background: linear-gradient(90deg, #ff6b00 50%, #333 50%);
      border-radius: 4px; outline: none;
    }
    #sizeSlider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 22px; height: 22px;
      border-radius: 50%; background: #ff9b3c;
      box-shadow: 0 2px 10px rgba(255,107,0,0.6); cursor: pointer;
    }
    .slider-val { color: #ffcc99; font-size: 11px; min-width: 30px; text-align: right; }

    /* Category pills */
    #pills {
      display: flex; gap: 7px; overflow-x: auto; scrollbar-width: none; padding-bottom: 2px;
    }
    #pills::-webkit-scrollbar { display: none; }
    .pill {
      white-space: nowrap; padding: 8px 16px; border-radius: 30px;
      font-size: 12px; font-weight: 700; cursor: pointer;
      border: 1.5px solid rgba(255,107,0,0.3); color: #ff9b3c99;
      background: rgba(0,0,0,0.45); transition: all 0.18s; letter-spacing: 0.3px;
    }
    .pill.active {
      background: linear-gradient(135deg, #ff6b00, #ffaa44);
      color: white; border-color: transparent;
      box-shadow: 0 4px 16px rgba(255,107,0,0.4);
    }

    /* ‚îÄ‚îÄ INFO CARD ‚îÄ‚îÄ */
    #infoCard {
      position: fixed; bottom: 130px; left: 50%;
      transform: translateX(-50%) translateY(140%);
      z-index: 300; width: calc(100% - 36px); max-width: 390px;
      background: rgba(8,3,0,0.96);
      border: 1.5px solid rgba(255,107,0,0.35);
      border-radius: 26px; padding: 22px 22px 18px;
      backdrop-filter: blur(24px);
      box-shadow: 0 24px 70px rgba(255,107,0,0.18);
      transition: transform 0.38s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    #infoCard.open { transform: translateX(-50%) translateY(0); }
    .card-row { display: flex; align-items: flex-start; justify-content: space-between; gap: 10px; }
    #cardName { color: #ff9b3c; font-size: 20px; font-weight: 800; }
    #cardPrice {
      background: linear-gradient(135deg, #ff6b00, #ffaa44);
      color: white; padding: 6px 14px; border-radius: 20px;
      font-size: 14px; font-weight: 800; white-space: nowrap;
    }
    #cardDesc { color: #ffcc9977; font-size: 13px; line-height: 1.65; margin: 10px 0; }
    #cardTags { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 14px; }
    .ftag {
      background: rgba(255,107,0,0.12); border: 1px solid rgba(255,107,0,0.25);
      color: #ff9b3caa; font-size: 11px; padding: 3px 10px; border-radius: 20px;
    }
    #closeCard {
      display: block; width: 100%;
      padding: 12px; background: rgba(255,107,0,0.15);
      border: 1px solid rgba(255,107,0,0.3);
      border-radius: 14px; color: #ff9b3c;
      font-size: 14px; font-weight: 700; cursor: pointer;
      text-align: center; transition: background 0.18s;
    }
    #closeCard:active { background: rgba(255,107,0,0.35); }

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    #toast {
      position: fixed; top: 75px; left: 50%;
      transform: translateX(-50%); z-index: 500;
      background: rgba(0,0,0,0.82);
      border: 1px solid rgba(255,107,0,0.3);
      color: #ffcc99; font-size: 13px;
      padding: 9px 20px; border-radius: 30px;
      backdrop-filter: blur(10px);
      white-space: nowrap; pointer-events: none;
      transition: opacity 0.5s; opacity: 0;
    }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPLASH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="splash">
  <div class="splash-icon">üçï</div>
  <div class="splash-title">AR Menu</div>
  <span class="badge">NO APP NEEDED ¬∑ WORKS ON ANY PHONE</span>

  <div class="marker-box">
    <!-- HIRO marker preview ‚Äî this is what you print and place on the table -->
    <img
      src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png"
      alt="HIRO Marker"
      onerror="this.style.display='none'; document.getElementById('markerFallback').style.display='flex'"/>
    <div id="markerFallback" style="display:none; flex-direction:column; align-items:center; gap:6px; padding:10px; text-align:center;">
      <div style="font-size:38px">üñ®Ô∏è</div>
      <div style="color:#ff9b3c; font-size:11px;">Print HIRO marker<br/>from AR.js GitHub</div>
    </div>
    <div class="scan-line-anim"></div>
    <div class="marker-hint">PRINT &amp; PLACE ON TABLE</div>
  </div>

  <div class="marker-label">Print the marker above ‚Üí place on table ‚Üí tap START</div>
  <p class="splash-sub">Point your camera at the printed marker and the 3D menu will float above your table</p>
  <button id="launch-btn" onclick="launchAR()">üéØ Start AR</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AR SCENE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="ar-scene-wrap">
  <a-scene
    id="arScene"
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    renderer="logarithmicDepthBuffer: true; antialias: true;"
    vr-mode-ui="enabled: false"
    style="width:100%;height:100%;">

    <a-assets>
      <a-asset-item id="pizzaModel" src="pizza.glb"></a-asset-item>
    </a-assets>

    <!-- HIRO MARKER ‚Äî built-in, no .mind file needed -->
    <a-marker id="mainMarker" preset="hiro" smooth="true" smoothCount="5">

      <a-entity id="menuGroup" position="0 0 0" rotation="0 0 0" scale="1 1 1">

        <!-- Table mat -->
        <a-cylinder position="0 0.005 0" radius="0.62" height="0.008"
          color="#1a0800" opacity="0.65" roughness="0.9">
        </a-cylinder>

        <!-- ‚îÄ‚îÄ ITEM 0 ‚Äî Margherita Pizza ‚îÄ‚îÄ -->
        <a-entity id="item-0" class="menu-item"
          data-name="Margherita Pizza" data-price="$12.99"
          data-desc="Fresh tomato sauce, mozzarella and basil on a crispy wood-fired crust."
          data-tags="Vegetarian,Classic,Best Seller" data-emoji="üçï"
          position="-0.35 0 -0.1">

          <a-gltf-model src="#pizzaModel" scale="0.08 0.08 0.08" rotation="-90 0 0"
            animation__float="property: position; from: 0 0.06 0; to: 0 0.14 0; dur: 1800; dir: alternate; loop: true; easing: easeInOutSine"
            animation__spin="property: rotation; to: -90 360 0; dur: 5000; loop: true; easing: linear"
            onerror="this.setAttribute('visible',false); document.getElementById('fb0').setAttribute('visible',true)">
          </a-gltf-model>
          <!-- Fallback shape -->
          <a-cylinder id="fb0" visible="false" radius="0.1" height="0.035" color="#e8441a"
            position="0 0.08 0"
            animation__float="property: position; from: 0 0.06 0; to: 0 0.14 0; dur: 1800; dir: alternate; loop: true; easing: easeInOutSine"
            animation__spin="property: rotation; to: 0 360 0; dur: 5000; loop: true; easing: linear">
          </a-cylinder>

          <a-text value="Margherita" align="center" position="0 0.26 0" color="#ff9b3c" width="1.1"></a-text>
          <a-text value="$12.99"     align="center" position="0 0.18 0" color="#ffffff"  width="0.85"></a-text>
          <!-- Tap target -->
          <a-plane position="0 0.1 0" rotation="-90 0 0" width="0.3" height="0.3" opacity="0.0" class="clickable"></a-plane>
        </a-entity>

        <!-- ‚îÄ‚îÄ ITEM 1 ‚Äî Pepperoni Supreme ‚îÄ‚îÄ -->
        <a-entity id="item-1" class="menu-item"
          data-name="Pepperoni Supreme" data-price="$14.99"
          data-desc="Loaded with premium pepperoni, extra cheese, and house-made tomato sauce."
          data-tags="Spicy,Popular,Chef's Choice" data-emoji="üçï"
          position="0.35 0 -0.1">

          <a-gltf-model src="#pizzaModel" scale="0.08 0.08 0.08" rotation="-90 0 0"
            animation__float="property: position; from: 0 0.08 0; to: 0 0.16 0; dur: 2100; dir: alternate; loop: true; easing: easeInOutSine"
            animation__spin="property: rotation; to: -90 360 0; dur: 4500; loop: true; easing: linear"
            onerror="this.setAttribute('visible',false); document.getElementById('fb1').setAttribute('visible',true)">
          </a-gltf-model>
          <a-cylinder id="fb1" visible="false" radius="0.1" height="0.035" color="#c0392b"
            position="0 0.1 0"
            animation__float="property: position; from: 0 0.08 0; to: 0 0.16 0; dur: 2100; dir: alternate; loop: true; easing: easeInOutSine"
            animation__spin="property: rotation; to: 0 360 0; dur: 4500; loop: true; easing: linear">
          </a-cylinder>

          <a-text value="Pepperoni" align="center" position="0 0.26 0" color="#ff9b3c" width="1.1"></a-text>
          <a-text value="$14.99"    align="center" position="0 0.18 0" color="#ffffff"  width="0.85"></a-text>
          <a-plane position="0 0.1 0" rotation="-90 0 0" width="0.3" height="0.3" opacity="0.0" class="clickable"></a-plane>
        </a-entity>

        <!-- ‚îÄ‚îÄ ITEM 2 ‚Äî Pasta ‚îÄ‚îÄ -->
        <a-entity id="item-2" class="menu-item"
          data-name="Pasta Alfredo" data-price="$10.99"
          data-desc="Creamy white sauce with aged parmesan and fresh herbs."
          data-tags="Vegetarian,Creamy,Comfort Food" data-emoji="üçù"
          position="0 0 0.38">

          <a-sphere radius="0.09" color="#f5c518" roughness="0.6"
            position="0 0.1 0"
            animation__float="property: position; from: 0 0.07 0; to: 0 0.15 0; dur: 1600; dir: alternate; loop: true; easing: easeInOutSine"
            animation__spin="property: rotation; to: 0 360 0; dur: 6000; loop: true; easing: linear">
          </a-sphere>

          <a-text value="üçù Pasta"  align="center" position="0 0.26 0" color="#ff9b3c" width="1.1"></a-text>
          <a-text value="$10.99"    align="center" position="0 0.18 0" color="#ffffff"  width="0.85"></a-text>
          <a-plane position="0 0.1 0" rotation="-90 0 0" width="0.3" height="0.3" opacity="0.0" class="clickable"></a-plane>
        </a-entity>

        <!-- ‚îÄ‚îÄ ITEM 3 ‚Äî Cheeseburger ‚îÄ‚îÄ -->
        <a-entity id="item-3" class="menu-item"
          data-name="Classic Cheeseburger" data-price="$9.99"
          data-desc="Juicy beef patty, cheddar, lettuce, tomato and our secret sauce."
          data-tags="Juicy,Comfort Food,Popular" data-emoji="üçî"
          position="0 0 -0.42">

          <a-box width="0.14" height="0.1" depth="0.14" color="#d4521a" roughness="0.7"
            position="0 0.1 0"
            animation__float="property: position; from: 0 0.08 0; to: 0 0.16 0; dur: 2300; dir: alternate; loop: true; easing: easeInOutSine"
            animation__spin="property: rotation; to: 0 360 0; dur: 5500; loop: true; easing: linear">
          </a-box>

          <a-text value="üçî Burger" align="center" position="0 0.26 0" color="#ff9b3c" width="1.1"></a-text>
          <a-text value="$9.99"     align="center" position="0 0.18 0" color="#ffffff"  width="0.85"></a-text>
          <a-plane position="0 0.1 0" rotation="-90 0 0" width="0.3" height="0.3" opacity="0.0" class="clickable"></a-plane>
        </a-entity>

      </a-entity><!-- /menuGroup -->
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HUD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="hud">

  <div id="topbar">
    <span class="brand">üçΩÔ∏è Bella Vista</span>
    <span class="ar-badge">‚óè LIVE AR</span>
  </div>

  <div id="track-status">
    <div class="finder">üîç</div>
    <p>Point at the HIRO marker on the table</p>
  </div>

  <div id="right-ctrl">
    <div class="ctrl-group">
      <div class="cbtn active" id="btn-view"   onclick="setMode('view')">üëÅÔ∏è</div>
      <div class="clabel">VIEW</div>
    </div>
    <div class="ctrl-group">
      <div class="cbtn" id="btn-move"   onclick="setMode('move')">‚úã</div>
      <div class="clabel">MOVE</div>
    </div>
    <div class="ctrl-group">
      <div class="cbtn" id="btn-rotate" onclick="setMode('rotate')">üîÑ</div>
      <div class="clabel">ROTATE</div>
    </div>
    <div class="ctrl-group">
      <div class="cbtn" onclick="resetAll()">‚Ü∫</div>
      <div class="clabel">RESET</div>
    </div>
  </div>

  <div id="bottombar">
    <div class="slider-row">
      <span class="slider-label">SIZE</span>
      <input type="range" id="sizeSlider" min="1" max="100" value="50" oninput="onSize(this.value)"/>
      <span class="slider-val" id="sizeVal">1.0√ó</span>
    </div>
    <div id="pills">
      <div class="pill active" onclick="filterCat('all',this)">üçΩÔ∏è All</div>
      <div class="pill" onclick="filterCat('pizza',this)">üçï Pizza</div>
      <div class="pill" onclick="filterCat('burger',this)">üçî Burgers</div>
      <div class="pill" onclick="filterCat('pasta',this)">üçù Pasta</div>
    </div>
  </div>

</div>

<!-- INFO CARD -->
<div id="infoCard">
  <div class="card-row" style="margin-bottom:8px">
    <div id="cardName">Item Name</div>
    <div id="cardPrice">$0.00</div>
  </div>
  <div id="cardDesc">Description</div>
  <div id="cardTags"></div>
  <button id="closeCard" onclick="closeCard()">‚úï Close</button>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCRIPT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
'use strict';

// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentMode  = 'view';
let isTracking   = false;
let currentScale = 1.0;
let isDragging   = false;
let lastTX = 0, lastTY = 0;
let pinchStart = 0, pinchScaleStart = 1.0;

const ITEMS = [
  { id: 'item-0', cat: 'pizza'  },
  { id: 'item-1', cat: 'pizza'  },
  { id: 'item-2', cat: 'pasta'  },
  { id: 'item-3', cat: 'burger' },
];

// ‚îÄ‚îÄ Launch AR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function launchAR() {
  document.getElementById('splash').style.display       = 'none';
  document.getElementById('ar-scene-wrap').style.display = 'block';
  document.getElementById('hud').style.display           = 'block';
  showToast('üì± Scanning... point camera at the HIRO marker');

  const scene = document.getElementById('arScene');
  if (scene.hasLoaded) { wireEvents(); }
  else { scene.addEventListener('loaded', wireEvents, { once: true }); }
}

// ‚îÄ‚îÄ Wire A-Frame events ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function wireEvents() {
  const marker      = document.getElementById('mainMarker');
  const trackStatus = document.getElementById('track-status');

  marker.addEventListener('markerFound', () => {
    isTracking = true;
    trackStatus.classList.add('hidden');
    showToast('‚úÖ Menu detected! Tap a dish for details');
  });

  marker.addEventListener('markerLost', () => {
    isTracking = false;
    trackStatus.classList.remove('hidden');
    showToast('üîç Lost marker ‚Äî point camera back at it');
  });

  // Tap on menu items
  document.querySelectorAll('.menu-item').forEach(el => {
    // A-Frame click via cursor or direct DOM click on the invisible plane
    el.addEventListener('click', () => {
      if (currentMode !== 'view') return;
      showCard(el.dataset);
    });
  });

  // Touch drag / pinch on the canvas
  const canvas = document.querySelector('#ar-scene-wrap canvas');
  if (!canvas) return;

  canvas.addEventListener('touchstart', e => {
    isDragging = false;
    if (e.touches.length === 1) {
      lastTX = e.touches[0].clientX;
      lastTY = e.touches[0].clientY;
    }
    if (e.touches.length === 2) {
      pinchStart      = getPinchDist(e);
      pinchScaleStart = currentScale;
    }
  }, { passive: true });

  canvas.addEventListener('touchmove', e => {
    const mg = document.getElementById('menuGroup');
    if (!mg) return;

    if (e.touches.length === 1) {
      const dx = e.touches[0].clientX - lastTX;
      const dy = e.touches[0].clientY - lastTY;
      if (Math.abs(dx) > 3 || Math.abs(dy) > 3) isDragging = true;

      if (currentMode === 'move') {
        const pos = mg.getAttribute('position');
        mg.setAttribute('position', {
          x: pos.x + dx * 0.0012,
          y: pos.y,
          z: pos.z + dy * 0.0012
        });
      } else if (currentMode === 'rotate') {
        const rot = mg.getAttribute('rotation');
        mg.setAttribute('rotation', { x: rot.x, y: rot.y + dx * 0.6, z: rot.z });
      }
      lastTX = e.touches[0].clientX;
      lastTY = e.touches[0].clientY;
    }

    if (e.touches.length === 2) {
      const d = getPinchDist(e);
      currentScale = Math.min(Math.max(pinchScaleStart * (d / pinchStart), 0.1), 5.0);
      mg.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
      syncSlider(currentScale);
      isDragging = true;
      e.preventDefault();
    }
  }, { passive: false });
}

function getPinchDist(e) {
  const dx = e.touches[0].clientX - e.touches[1].clientX;
  const dy = e.touches[0].clientY - e.touches[1].clientY;
  return Math.sqrt(dx * dx + dy * dy);
}

// ‚îÄ‚îÄ Mode buttons ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setMode(mode) {
  currentMode = mode;
  ['view','move','rotate'].forEach(m =>
    document.getElementById('btn-' + m).classList.toggle('active', m === mode));
  const msgs = {
    view:   'üëÅÔ∏è Tap a dish to see details',
    move:   '‚úã Drag to reposition the menu',
    rotate: 'üîÑ Drag to rotate the menu',
  };
  showToast(msgs[mode]);
}

// ‚îÄ‚îÄ Size slider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onSize(val) {
  // val 1‚Äì100 ‚Üí scale 0.1 ‚Äì 4.0
  currentScale = 0.1 + (val / 100) * 3.9;
  const mg = document.getElementById('menuGroup');
  if (mg) mg.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
  document.getElementById('sizeVal').textContent = currentScale.toFixed(1) + '√ó';
  const pct = val + '%';
  document.getElementById('sizeSlider').style.background =
    `linear-gradient(90deg, #ff6b00 ${pct}, #333 ${pct})`;
}

function syncSlider(s) {
  const val = Math.round(((s - 0.1) / 3.9) * 100);
  document.getElementById('sizeSlider').value = Math.min(100, Math.max(1, val));
  document.getElementById('sizeVal').textContent = s.toFixed(1) + '√ó';
}

// ‚îÄ‚îÄ Reset ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function resetAll() {
  const mg = document.getElementById('menuGroup');
  if (!mg) return;
  mg.setAttribute('position', '0 0 0');
  mg.setAttribute('rotation', '0 0 0');
  mg.setAttribute('scale',    '1 1 1');
  currentScale = 1.0;
  document.getElementById('sizeSlider').value = 50;
  document.getElementById('sizeVal').textContent = '1.0√ó';
  showToast('‚Ü∫ Reset to original');
}

// ‚îÄ‚îÄ Filter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterCat(cat, el) {
  document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  ITEMS.forEach(item => {
    const node = document.getElementById(item.id);
    if (node) node.setAttribute('visible', String(cat === 'all' || item.cat === cat));
  });
  showToast(cat === 'all' ? 'üçΩÔ∏è Showing all items' : `Showing ${cat}`);
}

// ‚îÄ‚îÄ Info card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showCard(d) {
  document.getElementById('cardName').textContent  = (d.emoji || '') + ' ' + d.name;
  document.getElementById('cardPrice').textContent = d.price;
  document.getElementById('cardDesc').textContent  = d.desc;
  const tags = (d.tags || '').split(',').filter(Boolean);
  document.getElementById('cardTags').innerHTML =
    tags.map(t => `<span class="ftag">${t.trim()}</span>`).join('');
  document.getElementById('infoCard').classList.add('open');
}
function closeCard() {
  document.getElementById('infoCard').classList.remove('open');
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3200);
}
</script>
</body>
</html>
