<!DOCTYPE html>
<html>
<head>
  <title>Bon AppÃ©tit AR Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/fcor/arjs-gestures/dist/gestures.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
    }

    /* Force camera video to fill entire screen */
    video {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      min-width: 100vw !important;
      min-height: 100vh !important;
      object-fit: cover !important;
      z-index: 0 !important;
      transform: none !important;
    }

    canvas {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 1 !important;
    }

    a-scene {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
    }

    /* Hide all loading UI */
    .arjs-loader,
    .a-loader-title,
    .a-enter-vr,
    .a-orientation-modal,
    [data-aframe-default-button] {
      display: none !important;
    }

    /* Loading overlay */
    #loading-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: #000;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-family: sans-serif;
      font-size: 18px;
      gap: 16px;
      transition: opacity 0.5s;
    }

    .spinner {
      width: 48px; height: 48px;
      border: 4px solid rgba(255,255,255,0.2);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    #marker-hint {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-family: sans-serif;
      font-size: 14px;
      z-index: 100;
      pointer-events: none;
      text-align: center;
    }
  </style>
</head>
<body>

<!-- Loading screen -->
<div id="loading-overlay">
  <div class="spinner"></div>
  <span>Loading AR Menu...</span>
  <span style="font-size:13px; opacity:0.6;">Allow camera access when prompted</span>
</div>

<div id="marker-hint">Point camera at a menu marker ðŸ“·</div>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  loading-screen="enabled: false"
  renderer="antialias: true; alpha: true; logarithmicDepthBuffer: true;"
  arjs="
    sourceType: webcam;
    facingMode: environment;
    debugUIEnabled: false;
    detectionMode: mono_and_matrix;
    trackingMethod: best;
    sourceWidth: 800;
    sourceHeight: 600;
    displayWidth: 1280;
    displayHeight: 960;
  "
  gesture-detector
>
  <a-assets timeout="30000">
    <a-asset-item id="m-pizza" src="pizza.glb"></a-asset-item>
    <a-asset-item id="m-hotchoco" src="hot_chocolate.glb"></a-asset-item>
    <a-asset-item id="m-matcha" src="iced_matcha.glb"></a-asset-item>
    <a-asset-item id="m-donut" src="maple_donut.glb"></a-asset-item>
    <a-asset-item id="m-rollcake" src="sakura_cake_roll.glb"></a-asset-item>
    <a-asset-item id="m-burger" src="burger.glb"></a-asset-item>
    <a-asset-item id="m-shawarma" src="shawarma.glb"></a-asset-item>
  </a-assets>

  <!-- LIGHTING: strong ambient so models don't appear dark -->
  <a-entity light="type: ambient; color: #fff; intensity: 2.5;"></a-entity>
  <a-entity light="type: directional; color: #fff; intensity: 1.5;" position="1 2 1"></a-entity>

  <!-- MARKERS -->
  <a-marker type="pattern" url="pattern-images.patt" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
    <a-entity gltf-model="#m-pizza" scale="0.05 0.05 0.05" position="0 0 0"></a-entity>
  </a-marker>

  <a-marker type="pattern" url="pattern-latte.patt" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
    <a-entity gltf-model="#m-matcha" scale="0.5 0.5 0.5" position="0 0 0"></a-entity>
  </a-marker>

  <a-marker type="pattern" url="pattern-donut.patt" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
    <a-entity gltf-model="#m-donut" scale="0.8 0.8 0.8" position="0 0 0"></a-entity>
  </a-marker>

  <a-marker type="pattern" url="pattern-hotchoco.patt" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
    <a-entity gltf-model="#m-hotchoco" scale="0.5 0.5 0.5" position="0 0 0"></a-entity>
  </a-marker>

  <a-marker type="pattern" url="pattern-rollcake.patt" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
    <a-entity gltf-model="#m-rollcake" scale="0.8 0.8 0.8" position="0 0 0"></a-entity>
  </a-marker>

  <a-marker type="pattern" url="pattern-shawarma.patt" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
    <a-entity gltf-model="#m-shawarma" scale="0.5 0.5 0.5" position="0 0 0"></a-entity>
  </a-marker>

  <a-marker type="pattern" url="pattern-burger.patt" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
    <a-entity gltf-model="#m-burger" scale="0.3 0.3 0.3" position="0 0 0"></a-entity>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>
  // Hide loading overlay once scene is ready
  const scene = document.querySelector('a-scene');
  const overlay = document.getElementById('loading-overlay');

  function hideOverlay() {
    overlay.style.opacity = '0';
    setTimeout(() => overlay.style.display = 'none', 500);
  }

  if (scene.hasLoaded) {
    hideOverlay();
  } else {
    scene.addEventListener('loaded', hideOverlay);
  }

  // Fallback: hide after 6 seconds no matter what
  setTimeout(hideOverlay, 6000);

  // Force video/canvas to always fill screen on resize or orientation change
  function fixVideoSize() {
    const videos = document.querySelectorAll('video');
    const canvases = document.querySelectorAll('canvas');
    videos.forEach(v => {
      v.style.cssText = `
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        min-width: 100vw !important;
        min-height: 100vh !important;
        object-fit: cover !important;
        z-index: 0 !important;
      `;
    });
    canvases.forEach(c => {
      c.style.width = '100vw';
      c.style.height = '100vh';
    });
    if (scene.renderer) {
      scene.renderer.setSize(window.innerWidth, window.innerHeight);
    }
  }

  window.addEventListener('resize', fixVideoSize);
  window.addEventListener('orientationchange', () => setTimeout(fixVideoSize, 300));

  // Watch for video element being added (AR.js adds it dynamically)
  const observer = new MutationObserver(() => fixVideoSize());
  observer.observe(document.body, { childList: true, subtree: true });

  // Run once after short delay to catch late-added video
  setTimeout(fixVideoSize, 1000);
  setTimeout(fixVideoSize, 2000);
</script>
</body>
</html>
